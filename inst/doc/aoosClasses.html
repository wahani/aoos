<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2017-05-06" />

<title>aoosClasses</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">aoosClasses</h1>
<h4 class="date"><em>2017-05-06</em></h4>



<div id="aoos-classes" class="section level2">
<h2>aoos classes</h2>
<p>Most of what this package can do is inspired by the R-package R6. Unlike R6, aoos relies on the methods package and the S4 class system. It was not written to be superior with respect to efficiency. Use aoos if you want to use object oriented programming as a means to organise your source code.</p>
<ul>
<li>An aoos class definition is a R expression. You can write code and decide which objects are public.</li>
<li>You can use auto-complete to see public member functions.</li>
<li>You can use features of S4 (method dispatch).</li>
</ul>
<p>All examples in the following are adapted from the R6-package.</p>
</div>
<div id="basics" class="section level2">
<h2>Basics</h2>
<p>There is one function you have to remember:</p>
<ul>
<li><code>defineClass</code>: To define a class.</li>
</ul>
<p>Everything you define inside the class definition will be public, objects with a leading dot in the name will be private. This can be overwritten by the functions <code>private</code> and <code>public</code>. Every public member will inherit from class function. A “public field” is the get/set method for an object hidden behind a closure (see the class <em>Accessor</em> if you dislike this). An exception are objects which inherit from class ‘environment’ so basically all reference classes in R. Those you can access without get/set methods.</p>
<p>Here is a simple class definition:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(aoos)

Person &lt;-<span class="st"> </span><span class="kw">defineClass</span>(<span class="st">&quot;Person&quot;</span>, {
  
  personName &lt;-<span class="st"> &quot;&quot;</span>
  
  init &lt;-<span class="st"> </span>function(name) {
    self$<span class="kw">personName</span>(name)
    self$<span class="kw">greet</span>()
    }
  
  greet &lt;-<span class="st"> </span>function() {
    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;Hello, my name is &quot;</span>, self$<span class="kw">personName</span>(), <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>))
    }
  
  })</code></pre></div>
<p>The return value of <code>defineClass</code> is the constructor function which is assigned to the name <code>Person</code>. All arguments to the constructor will be passed on to <code>init</code> if you defined it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ann &lt;-<span class="st"> </span><span class="kw">Person</span>(<span class="st">&quot;Ann&quot;</span>)</code></pre></div>
<pre><code>## Hello, my name is Ann.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ann</code></pre></div>
<pre><code>## Class: Person
## public member:
##   greet 
##   init 
##   personName 
##   self</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ann$<span class="kw">personName</span>()</code></pre></div>
<pre><code>## [1] &quot;Ann&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ann$<span class="kw">personName</span>(<span class="st">&quot;not Ann&quot;</span>)
ann$<span class="kw">greet</span>()</code></pre></div>
<pre><code>## Hello, my name is not Ann.</code></pre>
<p>Inside the class definition you can use <code>self</code> but you do not have to; It just might be more explicit. You can also use the super-assignment operator <code>&lt;&lt;-</code> to replace private fields. The following illustrates the difference:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Person &lt;-<span class="st"> </span><span class="kw">defineClass</span>(<span class="st">&quot;Person&quot;</span>, {
  
  .personName &lt;-<span class="st"> &quot;&quot;</span> <span class="co"># .personName is private</span>
  
  init &lt;-<span class="st"> </span>function(name) {
    self$.personName &lt;-<span class="st"> </span>name <span class="co"># option 1</span>
    .personName &lt;&lt;-<span class="st"> </span>name <span class="co"># option 2</span>
    <span class="kw">greet</span>()
    }
  
  greet &lt;-<span class="st"> </span><span class="kw">public</span>(function() {
    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;Hello, my name is &quot;</span>, .personName, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>)) <span class="co"># before: personName()</span>
    })
  })</code></pre></div>
<p>What you have to keep in mind is, that a public field is always hidden behind a get/set method and needs to be treated as a function. Private fields are just R objects and follow copy-on-modify semantics.</p>
</div>
<div id="predefined-methods" class="section level2">
<h2>Predefined methods</h2>
<p>aoos classes inherit from class ‘aoos’. For that class some S4-methods are defined you can use:</p>
<ul>
<li><code>show</code> which prints the public members of an object to the console</li>
<li><code>summary</code> which tries to give a clue how much memory is used by an object</li>
</ul>
<p>For every class you define with <code>defineClass</code> the S4 method <code>initialize</code> is set. Do not change it. You can also use the S4 constructor <code>new</code> to create a new instance of your class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">new</span>(<span class="st">&quot;Person&quot;</span>, <span class="st">&quot;Ann&quot;</span>)</code></pre></div>
<pre><code>## Hello, my name is Ann.</code></pre>
<pre><code>## Class: Person
## public member:
##   greet 
##   init 
##   personName 
##   self</code></pre>
</div>
<div id="inheritance" class="section level2">
<h2>Inheritance</h2>
<p>A class defined by <code>defineClass</code> can inherit from other aoos classes. The expression (<code>expr</code> in <code>defineClass</code>) is first evaluated for the parent and then for the child in the same environment. So you can override methods and fields.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Queue &lt;-<span class="st"> </span><span class="kw">defineClass</span>(<span class="st">&quot;Queue&quot;</span>, {

  .queue &lt;-<span class="st"> </span><span class="kw">list</span>()
  
  init &lt;-<span class="st"> </span>function(...) {
      for (item in <span class="kw">list</span>(...)) self$<span class="kw">add</span>(item)
    }
  
  add &lt;-<span class="st"> </span>function(x) {
      .queue &lt;&lt;-<span class="st"> </span><span class="kw">c</span>(.queue, <span class="kw">list</span>(x))
      <span class="kw">invisible</span>(self)
    }

  remove &lt;-<span class="st"> </span>function() {
      if (<span class="kw">queueIsEmpty</span>()) <span class="kw">return</span>(<span class="ot">NULL</span>)
      head &lt;-<span class="st"> </span>.queue[[<span class="dv">1</span>]]
      .queue &lt;&lt;-<span class="st"> </span>.queue[-<span class="dv">1</span>]
      head
    }

  queueIsEmpty &lt;-<span class="st"> </span>function() <span class="kw">length</span>(.queue) ==<span class="st"> </span><span class="dv">0</span>
  
})

HistoryQueue &lt;-<span class="st"> </span><span class="kw">defineClass</span>(<span class="st">&quot;HistoryQueue&quot;</span>, <span class="dt">contains =</span> <span class="st">&quot;Queue&quot;</span>, {
  
  .head_idx &lt;-<span class="st"> </span><span class="dv">0</span>
  
  remove &lt;-<span class="st"> </span>function() {
    if ((<span class="kw">length</span>(.queue) -<span class="st"> </span>.head_idx) ==<span class="st"> </span><span class="dv">0</span>) <span class="kw">return</span>(<span class="ot">NULL</span>)
    self$.head_idx &lt;-<span class="st"> </span>.head_idx +<span class="st"> </span><span class="dv">1</span>
    .queue[[.head_idx]]
    }
  
  show &lt;-<span class="st"> </span>function() {
      <span class="kw">cat</span>(<span class="st">&quot;Next item is at index&quot;</span>, .head_idx +<span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
      for (i in <span class="kw">seq_along</span>(.queue)) {
        <span class="kw">cat</span>(i, <span class="st">&quot;: &quot;</span>, .queue[[i]], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
      }
    }
  
  })

q &lt;-<span class="st"> </span><span class="kw">Queue</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="st">&quot;foo&quot;</span>)
q$<span class="kw">remove</span>()</code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">q</code></pre></div>
<pre><code>## Class: Queue
## public member:
##   add 
##   init 
##   queueIsEmpty 
##   remove 
##   self</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hq &lt;-<span class="st"> </span><span class="kw">HistoryQueue</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="st">&quot;foo&quot;</span>)
hq</code></pre></div>
<pre><code>## Class: HistoryQueue
## public member:
##   add 
##   init 
##   queueIsEmpty 
##   remove 
##   self 
##   show</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hq$<span class="kw">show</span>()</code></pre></div>
<pre><code>## Next item is at index 1 
## 1: 5
## 2: 6
## 3: foo</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hq$<span class="kw">remove</span>()</code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hq$<span class="kw">show</span>()</code></pre></div>
<pre><code>## Next item is at index 2 
## 1: 5
## 2: 6
## 3: foo</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hq$<span class="kw">remove</span>()</code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Since these classes use the S4 system you can use <code>setMethod</code> to define additional methods like <code>show</code>. Define S4-methods always outside the <code>defineClass</code> function as <code>expr</code> will be evaluated every time a new instance is created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;show&quot;</span>, <span class="st">&quot;HistoryQueue&quot;</span>, function(object) {
  object$<span class="kw">show</span>()
})</code></pre></div>
<pre><code>## [1] &quot;show&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hq</code></pre></div>
<pre><code>## Next item is at index 3 
## 1: 5
## 2: 6
## 3: foo</code></pre>
</div>
<div id="inheritance-across-packages" class="section level2">
<h2>Inheritance across packages</h2>
<p>This is a little tricky. <code>expr</code> is evaluated in a new environment whenever you create a new instance. If one class inherits from another the same environment is used for the evaluation. Thus, objects of the parent can be replaced and the scoping of the parent is preserved; functions defined for the parent and the child share the same environment. The parent environment of an aoos class is the environment in which <code>defineClass</code> (for the parent) is called. This will typically be a package namespace. If you define class B in package pkgB which inherits from a class A from package pkgA class B will have the same scoping as a class in pkgA. Whenever you want to use functions from pkgB in class B you have to define them as part of the class definition or refer to them with <code>pkgB::&quot;functionName&quot;</code> or <code>pkgB:::&quot;functionName&quot;</code>.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
