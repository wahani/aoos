<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>aoos by wahani</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>aoos</h1>
        <h2>Another Object Oriantation System in R</h2>
        <a href="https://github.com/wahani/aoos" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p><a href="https://travis-ci.org/wahani/aoos"><img src="https://travis-ci.org/wahani/aoos.png?branch=master" alt="Build Status"></a>
<a href="http://cran.rstudio.com/web/packages/aoos"><img src="http://www.r-pkg.org/badges/version/aoos" alt="CRAN Version"></a>
<img src="http://cranlogs.r-pkg.org/badges/aoos" alt="">
<a href="https://codecov.io/github/wahani/aoos?branch=master"><img src="https://codecov.io/github/wahani/aoos/coverage.svg?branch=master" alt="codecov.io"></a></p>

<h1>
<a id="another-object-orientation-system-in-r" class="anchor" href="#another-object-orientation-system-in-r" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Another object orientation system in R</h1>

<p>Another implementation of object-orientation in R. It provides syntactic sugar for the S4 class system and two alternative new implementations. One is an experimental version built around S4 and the other one makes it more convenient to work with lists as objects.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>To install from CRAN:</p>

<div class="highlight highlight-source-r"><pre>install.packages(<span class="pl-s"><span class="pl-pds">"</span>aoos<span class="pl-pds">"</span></span>)</pre></div>

<p>To install from this repo:</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">devtools</span>)
install_github(<span class="pl-s"><span class="pl-pds">"</span>wahani/aoos<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples:</h2>

<h3>
<a id="retlist" class="anchor" href="#retlist" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>retList:</h3>

<p>Basically you define constructor functions. There is no <em>formal</em> class
definition. The function body will define what members an object will have. You
quit the function defining the return value using <code>retList</code> which is a <em>generic</em>
constructor function. By default it will look at the environment from which it
is called and convert that environment into a list. That list is returned and is
an object. Names with a "." are not part of the constructed <em>list</em> (by default).</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-s"><span class="pl-pds">"</span>aoos<span class="pl-pds">"</span></span>)
<span class="pl-en">Employee</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">name</span>, .<span class="pl-smi">salary</span>) {
  <span class="pl-s"><span class="pl-pds">"</span>Common base class for all employees<span class="pl-pds">"</span></span>

  <span class="pl-en">print</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-k">...</span>) {
    cat(<span class="pl-s"><span class="pl-pds">"</span>Name  : <span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">name</span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Salary: <span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">salary</span>)
  }

  <span class="pl-en">getName</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() .<span class="pl-smi">name</span>
  <span class="pl-en">getSalary</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">salary</span>

  retList(c(<span class="pl-s"><span class="pl-pds">"</span>Employee<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Print<span class="pl-pds">"</span></span>))

}

<span class="pl-smi">peter</span> <span class="pl-k">&lt;-</span> Employee(<span class="pl-s"><span class="pl-pds">"</span>Peter<span class="pl-pds">"</span></span>, <span class="pl-c1">5</span>)
<span class="pl-smi">peter</span></pre></div>

<pre><code>## Name  :  Peter 
## Salary:  5
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">peter</span><span class="pl-k">$</span>getName()</pre></div>

<pre><code>## [1] "Peter"
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">peter</span><span class="pl-k">$</span>getSalary()</pre></div>

<pre><code>## [1] 5
</code></pre>

<p>Here every instance is of class <em>Employee</em> and also inherits from class <em>Print</em>.
This enables us to define the print method in the functions body and is
equivalent to invoking the print method directly:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">peter</span></pre></div>

<pre><code>## Name  :  Peter 
## Salary:  5
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">peter</span><span class="pl-k">$</span>print()</pre></div>

<pre><code>## Name  :  Peter 
## Salary:  5
</code></pre>

<h3>
<a id="retlist--inheritance" class="anchor" href="#retlist--inheritance" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>retList + Inheritance:</h3>

<p>You can inherit methods and fields from a super class, or rather an instance,
because there is no <em>formal</em> class definition. Methods and fields can be
replaced in the child, all member from the parent are also available for the
methods of the child.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-en">Manager</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">name</span>, .<span class="pl-smi">salary</span>, .<span class="pl-smi">bonus</span>) {
  <span class="pl-s"><span class="pl-pds">"</span>Extending the Employee class<span class="pl-pds">"</span></span>

  <span class="pl-en">bonus</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>) {
    <span class="pl-k">if</span> (<span class="pl-k">!</span>missing(<span class="pl-smi">x</span>)) .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">bonus</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">x</span>
    .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">bonus</span>
  }

  <span class="pl-en">print</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-k">...</span>) {
    cat(<span class="pl-s"><span class="pl-pds">"</span>Name  : <span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">name</span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Salary: <span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">salary</span>, 
        <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>Bonus:<span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">bonus</span>)
  }

  retList(<span class="pl-s"><span class="pl-pds">"</span>Manager<span class="pl-pds">"</span></span>, <span class="pl-v">super</span> <span class="pl-k">=</span> Employee(.<span class="pl-smi">name</span>, .<span class="pl-smi">salary</span>))

}

<span class="pl-smi">julia</span> <span class="pl-k">&lt;-</span> Manager(<span class="pl-s"><span class="pl-pds">"</span>Julia<span class="pl-pds">"</span></span>, <span class="pl-c1">5</span>, <span class="pl-c1">5</span> <span class="pl-k">*</span> <span class="pl-c1">1e6</span>)
<span class="pl-smi">julia</span></pre></div>

<pre><code>## Name  :  Julia 
## Salary:  5 
## Bonus: 5e+06
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">julia</span><span class="pl-k">$</span>getSalary()</pre></div>

<pre><code>## [1] 5
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">julia</span><span class="pl-k">$</span>bonus(<span class="pl-c1">10</span>)</pre></div>

<pre><code>## [1] 10
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">julia</span></pre></div>

<pre><code>## Name  :  Julia 
## Salary:  5 
## Bonus: 10
</code></pre>

<h3>
<a id="s4-generics" class="anchor" href="#s4-generics" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>S4 generics</h3>

<p>As of version 0.3.1 there exist two binary operators, <code>%g%</code> and <code>%m%</code>, which
link to the S4 system for generic functions. They provide (hopefully) concise
alternatives to <code>methods::setGeneric</code> and <code>methods::setMethod</code>:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Standard definition for a generic without default:</span>
<span class="pl-smi">numeric</span> <span class="pl-k">:</span> strLength(<span class="pl-smi">x</span>, <span class="pl-k">...</span>) %<span class="pl-smi">g</span>% standardGeneric(<span class="pl-s"><span class="pl-pds">"</span>strLength<span class="pl-pds">"</span></span>)

<span class="pl-c"># A method for x:character</span>
strLength(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">character</span>, <span class="pl-k">...</span>) %<span class="pl-smi">m</span>% { nchar(<span class="pl-smi">x</span>) }

<span class="pl-c"># Kind of the default method for x:ANY</span>
strLength(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">ANY</span>, <span class="pl-k">...</span>) %<span class="pl-smi">m</span>% { strLength(as.character(<span class="pl-smi">x</span>)) }

<span class="pl-c"># Check that it works:</span>
strLength(<span class="pl-c1">123</span>)</pre></div>

<pre><code>## [1] 3
</code></pre>

<div class="highlight highlight-source-r"><pre>strLength(<span class="pl-s"><span class="pl-pds">"</span>ab<span class="pl-pds">"</span></span>)</pre></div>

<pre><code>## [1] 2
</code></pre>

<p>You may have noticed that we also constrained the return value of any method
belonging to the generic <code>strLength</code> to be a <em>numeric</em>. There exist methods
for objects of type <em>character</em> and <em>ANY</em> type.</p>

<p>In S4, methods can have defaults for arguments which are not formals of the
generic. Otherwise the defaults of the generic are passed down to its methods.
This is not changed: Define defaults for the generic. If a method has more
arguments than its generic you can define defaults for them. For the <em>shared</em>
argument names provide a class name. One exception to the rule is <code>...</code> which
can have no type. </p>

<h3>
<a id="s4-types" class="anchor" href="#s4-types" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>S4 Types</h3>

<p>The following presents the function <code>%type%</code> which is a link to S4s <code>setClass</code>. 
<code>%type%</code> tries to abstract a typical scenario of using <code>setClass</code>. </p>

<p>In the following We define two types. One is <em>Test</em> which has two fields, <em>x</em>
and <em>y</em>. <em>x</em> is of type <em>numeric</em>, <em>y</em> is a <em>list</em>. Notice that you can either
define a prototype (a default) for a field (for which the class is inferred), or
you state the class explicitly using <code>~</code>.</p>

<p>The second is <em>Child</em> and inherits the properties from <em>Test</em>. Thus it has
also two fields, <em>x</em> and <em>y</em>, and in addition we say it inherits from type
<em>character</em>. So <em>Child</em> is basically a character vector with two attributes:</p>

<div class="highlight highlight-source-r"><pre>Test(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">numeric</span>, <span class="pl-v">y</span> <span class="pl-k">=</span> <span class="pl-k">list</span>()) %<span class="pl-smi">type</span>% {
  stopifnot(length(.<span class="pl-smi">Object</span><span class="pl-k">@</span><span class="pl-smi">x</span>) <span class="pl-k">==</span> <span class="pl-c1">1</span>)
  stopifnot(.<span class="pl-smi">Object</span><span class="pl-k">@</span><span class="pl-smi">x</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>)
  .<span class="pl-smi">Object</span>
}

<span class="pl-smi">Test</span> <span class="pl-k">:</span> <span class="pl-smi">character</span> <span class="pl-k">:</span> Child() %<span class="pl-smi">type</span>% .<span class="pl-smi">Object</span>

Test(<span class="pl-c1">2</span>)</pre></div>

<pre><code>## An object of class "Test"
## Slot "x":
## [1] 2
## 
## Slot "y":
## list()
</code></pre>

<div class="highlight highlight-source-r"><pre>Child(<span class="pl-s"><span class="pl-pds">"</span>Hej<span class="pl-pds">"</span></span>, <span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>)</pre></div>

<pre><code>## An object of class "Child"
## [1] "Hej"
## Slot "x":
## [1] 2
## 
## Slot "y":
## list()
</code></pre>

<p>Notice that the right hand side of the expression is more or less the definition
of the initialization method for a type. Arbitrary operations can be made during 
init, in the above example we formulate some assertions (x &gt; 0 and scalar). The
init method for type <em>Child</em> just returns the object itself named <code>.Object</code>
(see the help page for <code>methods::initialize</code> to understand the naming).</p>

<h3>
<a id="s4-type-unions" class="anchor" href="#s4-type-unions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>S4 Type Unions</h3>

<p>S4 provides also the possibility to construct type unions which are useful to
allow a type to inherit from different types at the same time, e.g. a type which
can either be a <em>numeric</em> or <em>character</em>. This feature is not yet complete, but
here are some ways you can use it. For the definition of a type:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-s"><span class="pl-pds">'</span>numeric | character<span class="pl-pds">'</span></span> <span class="pl-k">:</span> Either() %<span class="pl-smi">type</span>% .<span class="pl-smi">Object</span>
Either(<span class="pl-c1">1</span>)</pre></div>

<pre><code>## An object of class "Either"
## [1] 1
</code></pre>

<div class="highlight highlight-source-r"><pre>Either(<span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-pds">"</span></span>)</pre></div>

<pre><code>## An object of class "Either"
## [1] "Hello World!"
</code></pre>

<p>In the definition of a field:</p>

<div class="highlight highlight-source-r"><pre>Either(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">numeric</span> <span class="pl-k">|</span> <span class="pl-smi">character</span>) %<span class="pl-smi">type</span>% .<span class="pl-smi">Object</span>
Either(<span class="pl-c1">1</span>)</pre></div>

<pre><code>## An object of class "Either"
## Slot "x":
## [1] 1
</code></pre>

<div class="highlight highlight-source-r"><pre>Either(<span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-pds">"</span></span>)</pre></div>

<pre><code>## An object of class "Either"
## Slot "x":
## [1] "Hello World!"
</code></pre>

<p>In the definition of a generic or method:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-s"><span class="pl-pds">'</span>numeric | character<span class="pl-pds">'</span></span> <span class="pl-k">:</span> complicatedFunction(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>) %<span class="pl-smi">g</span>% as.character(<span class="pl-smi">x</span>)
complicatedFunction(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">character</span> <span class="pl-k">|</span> <span class="pl-smi">integer</span>) %<span class="pl-smi">m</span>% as.numeric(<span class="pl-smi">x</span>)
complicatedFunction()</pre></div>

<pre><code>## [1] "1"
</code></pre>

<div class="highlight highlight-source-r"><pre>complicatedFunction(<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>)</pre></div>

<pre><code>## [1] 1
</code></pre>

<div class="highlight highlight-source-r"><pre>complicatedFunction(<span class="pl-c1">1L</span>)</pre></div>

<pre><code>## [1] 1
</code></pre>

<h3>
<a id="polymorphic-methods-in-objects" class="anchor" href="#polymorphic-methods-in-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Polymorphic Methods in Objects</h3>

<p>In contrast to the defaults in S4, <code>%g%</code> and <code>%m%</code> have side effects in the
environment they are called in. That means you can define generics which are 
local to a function or closure. Nice all by itself but it also extends the
<code>retList</code>-idea of representing objects in <em>R</em> as demonstrated here:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-en">Class</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() {

  overloaded(<span class="pl-smi">x</span>) %<span class="pl-smi">g</span>% { 
    cat(<span class="pl-s"><span class="pl-pds">"</span>This is the default ... <span class="pl-cce">\n</span><span class="pl-pds">"</span></span>)
    <span class="pl-smi">x</span> 
  } 

  overloaded(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">numeric</span>) %<span class="pl-smi">m</span>% {
    cat(<span class="pl-s"><span class="pl-pds">"</span>This is the method for 'numeric' values ... <span class="pl-cce">\n</span><span class="pl-pds">"</span></span>)
    <span class="pl-smi">x</span>
  }

  retList(<span class="pl-s"><span class="pl-pds">"</span>Class<span class="pl-pds">"</span></span>)
}

<span class="pl-smi">instance</span> <span class="pl-k">&lt;-</span> Class()
<span class="pl-smi">instance</span><span class="pl-k">$</span>overloaded(<span class="pl-c1">1</span>)</pre></div>

<pre><code>## This is the method for 'numeric' values ...
</code></pre>

<pre><code>## [1] 1
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">instance</span><span class="pl-k">$</span>overloaded(<span class="pl-s"><span class="pl-pds">"</span>a<span class="pl-pds">"</span></span>)</pre></div>

<pre><code>## This is the default ...
</code></pre>

<pre><code>## [1] "a"
</code></pre>

<p>The next question is how to inherit or extend an existing generic which is a
member of a class? I am not entirely happy with how this works at the moment,
but this is one way to approach it (which works...):</p>

<div class="highlight highlight-source-r"><pre><span class="pl-en">Child</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() {

  <span class="pl-c"># Normally you would make the call to the parents constructor in the call</span>
  <span class="pl-c"># to retList. But here we need to access the elements directly during init...</span>
  .<span class="pl-smi">super</span> <span class="pl-k">&lt;-</span> Class()

  <span class="pl-c"># This points %m% to the generic (in .super) which should be extended:</span>
  .<span class="pl-smi">super</span><span class="pl-k">$</span>overloaded(<span class="pl-smi">x</span> <span class="pl-k">~</span> <span class="pl-smi">integer</span>) %<span class="pl-smi">m</span>% {
    cat(<span class="pl-s"><span class="pl-pds">"</span>This is the method for 'integer' values ... <span class="pl-cce">\n</span><span class="pl-pds">"</span></span>)
    <span class="pl-smi">x</span>
  }

  retList(<span class="pl-s"><span class="pl-pds">"</span>Child<span class="pl-pds">"</span></span>, <span class="pl-v">super</span> <span class="pl-k">=</span> .<span class="pl-smi">super</span>)

}

<span class="pl-smi">instance</span> <span class="pl-k">&lt;-</span> Child()
<span class="pl-smi">instance</span><span class="pl-k">$</span>overloaded(<span class="pl-c1">1</span>)</pre></div>

<pre><code>## This is the method for 'numeric' values ...
</code></pre>

<pre><code>## [1] 1
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">instance</span><span class="pl-k">$</span>overloaded(<span class="pl-s"><span class="pl-pds">"</span>a<span class="pl-pds">"</span></span>)</pre></div>

<pre><code>## This is the default ...
</code></pre>

<pre><code>## [1] "a"
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">instance</span><span class="pl-k">$</span>overloaded(<span class="pl-c1">1L</span>)</pre></div>

<pre><code>## This is the method for 'integer' values ...
</code></pre>

<pre><code>## [1] 1
</code></pre>

<h3>
<a id="more-unsorted-ideas" class="anchor" href="#more-unsorted-ideas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>More unsorted ideas</h3>

<h4>
<a id="public-fields" class="anchor" href="#public-fields" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Public Fields</h4>

<p>Something you have to keep in mind is that returned objects are of class <em>list</em>.
If you want to have a public field you have to define get and set methods,
because you will see a copy of those fields in the object, they behave more like
an attribute.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-en">ObjectWithField</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">name</span>) {
  <span class="pl-en">getName</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() {
    <span class="pl-smi">name</span>
  }
  retList()
} 

<span class="pl-smi">obj</span> <span class="pl-k">&lt;-</span> ObjectWithField(<span class="pl-s"><span class="pl-pds">"</span>Alexander<span class="pl-pds">"</span></span>)
<span class="pl-smi">obj</span><span class="pl-k">$</span><span class="pl-smi">name</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>Noah<span class="pl-pds">"</span></span>
<span class="pl-smi">obj</span><span class="pl-k">$</span>getName()</pre></div>

<pre><code>## [1] "Alexander"
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">obj</span><span class="pl-k">$</span><span class="pl-smi">name</span></pre></div>

<pre><code>## [1] "Noah"
</code></pre>

<p>We can do more abstract representations of <em>things</em>. In this example I want to
create a constructor object which keeps track of how many instances it created.
Also every instance should know how many siblings it has, or in other words all
instances share a reference to a field accessible by all of them.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-en">initFamily</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">familyName</span>) {

  .<span class="pl-smi">superEnv</span> <span class="pl-k">&lt;-</span> environment()
  .<span class="pl-smi">count</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">0</span>

  <span class="pl-en">getCount</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() {
    cat(<span class="pl-s"><span class="pl-pds">"</span>There are<span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">count</span>, paste0(.<span class="pl-smi">familyName</span>, <span class="pl-s"><span class="pl-pds">"</span>s<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>out there.<span class="pl-pds">"</span></span>)
  }

  <span class="pl-en">new</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">name</span>) {
    <span class="pl-c"># happens on init</span>
    .<span class="pl-smi">count</span> <span class="pl-k">&lt;&lt;-</span> .<span class="pl-smi">count</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>

    <span class="pl-en">print</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-k">...</span>) cat(<span class="pl-s"><span class="pl-pds">"</span>My name is<span class="pl-pds">"</span></span>, .<span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">name</span>, .<span class="pl-smi">familyName</span>, <span class="pl-s"><span class="pl-pds">"</span>!<span class="pl-pds">"</span></span>)
    <span class="pl-en">countSiblings</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>() cat(<span class="pl-s"><span class="pl-pds">"</span>I have<span class="pl-pds">"</span></span>, .<span class="pl-smi">count</span>, <span class="pl-s"><span class="pl-pds">"</span>siblings!<span class="pl-pds">"</span></span>)

    <span class="pl-c"># So every instance knows about .count and .familyName:</span>
    retList(c(<span class="pl-s"><span class="pl-pds">"</span>Person<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Print<span class="pl-pds">"</span></span>), <span class="pl-v">superEnv</span> <span class="pl-k">=</span> new.env(<span class="pl-v">parent</span> <span class="pl-k">=</span> .<span class="pl-smi">superEnv</span>))
  }

  retList(<span class="pl-s"><span class="pl-pds">"</span>ConstructorPerson<span class="pl-pds">"</span></span>)

}

<span class="pl-smi">schmidt</span> <span class="pl-k">&lt;-</span> initFamily(<span class="pl-s"><span class="pl-pds">"</span>Schmidt<span class="pl-pds">"</span></span>)
<span class="pl-smi">schmidt</span><span class="pl-k">$</span>getCount()</pre></div>

<pre><code>## There are 0 Schmidts out there.
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">lisa</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">schmidt</span><span class="pl-k">$</span>new(<span class="pl-s"><span class="pl-pds">"</span>Lisa<span class="pl-pds">"</span></span>)

<span class="pl-smi">sandra</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">schmidt</span><span class="pl-k">$</span>new(<span class="pl-s"><span class="pl-pds">"</span>Sandra<span class="pl-pds">"</span></span>)
<span class="pl-smi">schmidt</span><span class="pl-k">$</span>getCount()</pre></div>

<pre><code>## There are 2 Schmidts out there.
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">sandra</span><span class="pl-k">$</span>countSiblings()</pre></div>

<pre><code>## I have 2 siblings!
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">sandra</span></pre></div>

<pre><code>## My name is Sandra Schmidt !
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">lisa</span></pre></div>

<pre><code>## My name is Lisa Schmidt !
</code></pre>

<h4>
<a id="self-contained-method-invocation" class="anchor" href="#self-contained-method-invocation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Self-contained Method Invocation</h4>

<p>These ideas can be combined to construct something object like in S4 with fields
as slots and methods contained in a list (other patterns can be thought of...):</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Some extra stuff to make the instance on which a method is invoked available</span>
<span class="pl-c"># during the call.</span>
<span class="pl-ent">setClass</span>("<span class="pl-en">Self</span>", contains = "VIRTUAL")

<span class="pl-ent">setMethod</span>("<span class="pl-en">$</span>", "Self", function(x, name) {
  <span class="pl-k">function</span>(<span class="pl-k">...</span>) <span class="pl-smi">x</span>[[<span class="pl-smi">name</span>]](<span class="pl-v">.Object</span> <span class="pl-k">=</span> <span class="pl-smi">x</span>, <span class="pl-k">...</span>)
})</pre></div>

<pre><code>## [1] "$"
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">Self</span> <span class="pl-k">:</span> <span class="pl-smi">Show</span> <span class="pl-k">:</span> <span class="pl-smi">Test</span> <span class="pl-k">:</span> <span class="pl-smi">list</span> <span class="pl-k">:</span> Super() %<span class="pl-smi">type</span>% {
  <span class="pl-en">method</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">Object</span>) .<span class="pl-smi">Object</span><span class="pl-k">@</span><span class="pl-smi">x</span> <span class="pl-k">*</span> <span class="pl-c1">2</span>
  <span class="pl-en">show</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">Object</span>) cat(<span class="pl-s"><span class="pl-pds">"</span>Value for x:<span class="pl-pds">"</span></span>, .<span class="pl-smi">Object</span><span class="pl-k">@</span><span class="pl-smi">x</span>)
  S3Part(.<span class="pl-smi">Object</span>) <span class="pl-k">&lt;-</span> retList(<span class="pl-v">super</span> <span class="pl-k">=</span> .<span class="pl-smi">Object</span>)
  .<span class="pl-smi">Object</span>
}

<span class="pl-smi">x</span> <span class="pl-k">&lt;-</span> Super(<span class="pl-v">x</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>)
<span class="pl-smi">x</span></pre></div>

<pre><code>## Value for x: 2
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">x</span><span class="pl-k">$</span>method()</pre></div>

<pre><code>## [1] 4
</code></pre>

<p>And for the S3 retList thing:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-s"><span class="pl-pds">"</span>$.Self<span class="pl-pds">"</span></span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-smi">name</span>) {
  <span class="pl-smi">callIsLocal</span> <span class="pl-k">&lt;-</span> any(sapply(<span class="pl-e">aoos</span><span class="pl-k">:::</span>envirSearch(<span class="pl-k">list</span>(parent.frame())), 
                            <span class="pl-smi">identical</span>, <span class="pl-v">y</span> <span class="pl-k">=</span> attr(<span class="pl-smi">x</span>, <span class="pl-s"><span class="pl-pds">"</span>.self<span class="pl-pds">"</span></span>)))
  <span class="pl-k">if</span> (<span class="pl-smi">callIsLocal</span>) {
    <span class="pl-smi">obj</span> <span class="pl-k">&lt;-</span> attr(<span class="pl-smi">x</span>, <span class="pl-s"><span class="pl-pds">"</span>.self<span class="pl-pds">"</span></span>)[[<span class="pl-smi">name</span>]]
    <span class="pl-k">if</span> (inherits(<span class="pl-smi">obj</span>, <span class="pl-s"><span class="pl-pds">"</span>function<span class="pl-pds">"</span></span>)) <span class="pl-k">function</span>(<span class="pl-k">...</span>) obj(<span class="pl-v">self</span> <span class="pl-k">=</span> <span class="pl-smi">x</span>, <span class="pl-k">...</span>)
    <span class="pl-k">else</span> <span class="pl-smi">obj</span>
  }
  <span class="pl-k">else</span> <span class="pl-k">function</span>(<span class="pl-k">...</span>) <span class="pl-smi">x</span>[[<span class="pl-smi">name</span>]](<span class="pl-v">self</span> <span class="pl-k">=</span> <span class="pl-smi">x</span>, <span class="pl-k">...</span>)
}

<span class="pl-s"><span class="pl-pds">"</span>$&lt;-.Self<span class="pl-pds">"</span></span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-smi">name</span>, <span class="pl-smi">value</span>) {
  <span class="pl-smi">callIsLocal</span> <span class="pl-k">&lt;-</span> any(sapply(<span class="pl-e">aoos</span><span class="pl-k">:::</span>envirSearch(<span class="pl-k">list</span>(parent.frame())), 
                            <span class="pl-smi">identical</span>, <span class="pl-v">y</span> <span class="pl-k">=</span> attr(<span class="pl-smi">x</span>, <span class="pl-s"><span class="pl-pds">"</span>.self<span class="pl-pds">"</span></span>)))

  <span class="pl-k">if</span> (<span class="pl-smi">callIsLocal</span>) {
    assign(<span class="pl-smi">name</span>, <span class="pl-v">value</span> <span class="pl-k">=</span> <span class="pl-smi">value</span>, <span class="pl-v">envir</span> <span class="pl-k">=</span> attr(<span class="pl-smi">x</span>, <span class="pl-s"><span class="pl-pds">"</span>.self<span class="pl-pds">"</span></span>))
  } <span class="pl-k">else</span> {
    stop(<span class="pl-s"><span class="pl-pds">"</span>This method has been disabled for objects of class 'Self'.<span class="pl-pds">"</span></span>)
  }

  <span class="pl-smi">x</span>
}

<span class="pl-en">Self</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">x</span>) {

  <span class="pl-en">setX</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">self</span>, <span class="pl-smi">val</span>) {
    <span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">x</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">val</span> 
    <span class="pl-k">invisible</span>(<span class="pl-smi">self</span>)
  }

  <span class="pl-en">getX</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">self</span>) {
    <span class="pl-smi">self</span><span class="pl-k">$</span>.<span class="pl-smi">x</span>
  }

  retList(c(<span class="pl-s"><span class="pl-pds">"</span>Self<span class="pl-pds">"</span></span>))

}

<span class="pl-smi">inst</span> <span class="pl-k">&lt;-</span> Self(<span class="pl-c1">2</span>)
<span class="pl-smi">inst</span><span class="pl-k">$</span>setX(<span class="pl-c1">3</span>)<span class="pl-k">$</span>setX(<span class="pl-c1">4</span>)
<span class="pl-smi">inst</span><span class="pl-k">$</span>getX()</pre></div>

<pre><code>## [1] 4
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">inst</span><span class="pl-k">$</span>.<span class="pl-smi">x</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">2</span></pre></div>

<pre><code>## Error in `$&lt;-.Self`(`*tmp*`, ".x", value = 2): This method has been disabled for objects of class 'Self'.
</code></pre>

<h4>
<a id="syntactic-sugar-for-return-list" class="anchor" href="#syntactic-sugar-for-return-list" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Syntactic Sugar for Return List</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-en">Person</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">name</span>) {

  <span class="pl-en">print</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-k">...</span>) {
    cat(paste0(<span class="pl-s"><span class="pl-pds">"</span>Hello, my name is <span class="pl-pds">"</span></span>, .<span class="pl-smi">name</span>, <span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>))
  }

  retList(c(<span class="pl-s"><span class="pl-pds">"</span>Person<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Print<span class="pl-pds">"</span></span>))

}

<span class="pl-en">Employee</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(.<span class="pl-smi">id</span>, <span class="pl-k">...</span>) {

  <span class="pl-en">print</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>, <span class="pl-k">...</span>) {
    cat(<span class="pl-s"><span class="pl-pds">"</span>Name: <span class="pl-pds">"</span></span>, .<span class="pl-smi">name</span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span>ID:   <span class="pl-pds">"</span></span>, .<span class="pl-smi">id</span>)
  }

  retList(<span class="pl-s"><span class="pl-pds">"</span>Employee<span class="pl-pds">"</span></span>) %<span class="pl-smi">inherit</span>% Person(<span class="pl-k">...</span>)

}

<span class="pl-s"><span class="pl-pds">"</span>%inherit%<span class="pl-pds">"</span></span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-smi">child</span>, <span class="pl-smi">parent</span>) {
  retList(class(<span class="pl-smi">child</span>), names(<span class="pl-smi">child</span>), <span class="pl-v">super</span> <span class="pl-k">=</span> <span class="pl-smi">parent</span>, <span class="pl-v">mergeFun</span> <span class="pl-k">=</span> <span class="pl-smi">envCopy</span>, list2env(<span class="pl-smi">child</span>))
}

<span class="pl-smi">kalle</span> <span class="pl-k">&lt;-</span> Employee(<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Kalle<span class="pl-pds">"</span></span>)
str(<span class="pl-smi">kalle</span>)</pre></div>

<pre><code>## List of 1
##  $ print:function (x, ...)  
##   ..- attr(*, "srcref")=Class 'srcref'  atomic [1:8] 13 12 15 3 12 3 13 15
##   .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x6c68c20&gt; 
##  - attr(*, ".self")=&lt;environment: 0x668d730&gt; 
##  - attr(*, "class")= chr [1:5] "Employee" "list" "Person" "Print" ...
</code></pre>

<div class="highlight highlight-source-r"><pre>class(<span class="pl-smi">kalle</span>)</pre></div>

<pre><code>## [1] "Employee" "list"     "Person"   "Print"    "list"
</code></pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/wahani/aoos/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/wahani/aoos/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/wahani/aoos"></a> is maintained by <a href="https://github.com/wahani">wahani</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
